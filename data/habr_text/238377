'238377 |@words недавно возникнуть необходимость решить следующий:2 несложный задачка есть:3 несколько десяток устройство:6 учебный комплекс:2 который:6 нужно:2 регулярно запрашивать текущий состояние общаться протокол:2 udp:3 хотеться сделать так:2 чтобы:4 задумываться цикл:3 опрос:3 определение какой прийти:4 ответ:5 просто посылать:3 запрос когда:4 результат:6 записывать он:2 задача:4 этот:2 решать ранний захотеться посмотреть насколько концепция async:3 await:6 упростить:2 сократить код оказаться что финальный занимать маленький страничка весь логика состоять всего лишь два:2 метод:5 чтение:3 сокет посылка:4 команда:5 вещий надо:2 принять внимание:2 это:4 после мы:3 ждать:3 мочь тогда необходимый:2 вернуть:3 исключение:4 сказать таймаут:2 асинхронный выглядеть образ update:3 public:2 task:13 byte:5 sendreceiveasync msg:3 string:2 int:3 port:3 timeout:2 var:7 endpoint:4 new:5 ipendpoint:5 ipaddress parse tcs:11 taskcompletionsource:7 try:3 tokensource:2 cancellationtokensource token:4 tcsdictionary:5 containskey tryadd client:3 send length result:2 withcancellation:3 return:2 finally:2 tryremove out:2 здесь стандартный udpclient должный сохранить словарик:6 ключ:3 наш соединение:4 именно начинаться заносить получать большой либо при:4 выбросить удалять сам:2 concurrentdictionary:2 использовать вместо dictionary для:3 тот:3 избежать проблема кросспоточный вызов:2 private tuple тут момент заслуживать метод-расширение нужный:2 поддержать отмена:2 операция помощь cancellationtoken:5 отменять возвращать превышение задать static:2 class taskextension this bool:2 using register trysetresult true:2 whenany throw operationcanceledexception вот:2 читаемый пока хватить сила если датаграмма иметь:2 адрес параметр уже:2 занести помещаться переходить обратно сообщение только рука место run null while receivedbytes:2 receive ref trygetvalue setresult catch socketexception невозможность продолжать работать итог радовать async-await множество как быть справедливо отметить комментарий sendreceiveudpasync обернуть случай выброс удаляться значение использование reactive extensions задачиhabrahabr post 238445