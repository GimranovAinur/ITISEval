'248033 |@words несколько:2 день назад установить asterisk:2 загрузить свой:3 старый конфигурация:3 маршрутизация вызов намереваться подключиться местный sip:3 провайдер буквально через минута:2 после:5 запуск:2 asterisk' обнаружить лог попытка:3 авторизация сервер:3 что:4 я:2 ничуть удивить такой:2 картина наблюдаться любой астериск смотреть интернет быть:5 принять волевой решение:2 поиграться любимый:2 микротик:5 менее питон:2 придумать делать этот:3 злоумышленник:2 итак мы иметься ubuntu server думать принципиально должный работать другой:2 дистрибутив fail2ban:8 mysql:8 или:2 люба сервис:2 который:6 нужно:2 защитить брут форс атака:2 роутереть:2 mikrotik:2 рука желание изобрести велосипед:2 прочтение пара стать один:2 два:2 родиться следующий:6 концепт банить определённый:2 время при:7 помощь:7 добавлять:4 запись:2 он:3 адрес:6 количество:3 выдать:2 бановый:3 список:4 запретить роутеря теперь реализация создавать:3 таблица содержимый:2 информация код страна:2 название тип jail name:23 последний задел будущее возможно как-то ещё использовать:3 дать:5 схемаcreate database:2 character set:2 utf8 create table ban:9 history:5 int:2 unsigned not:13 null:9 auto increment address:6 char default:5 country:14 code:6 varchar:3 count:12 type:18 last:3 attempt:4 datetime:5 first:2 primary key engine=innodb charset=utf8 скрипт:23 для:16 добавление:3 написать требовать работа дополнительный модуль:2 pygeoip:4 mysql-python:2 оба легко устанавливаться пакетный менеджер pip:2 install usr:2 bin:2 env:2 python2:2 coding:2 utf-8:2 import:22 urllib:2 gzip:2 stringio:3 logging:22 handlers:4 mysqldb:10 cursors:4 configparser:4 from:8 sys:2 exit:21 optparse:2 optionparser:4 def:4 main:6 config:26 logger:43 addr:14 attack:10 geoip:8 dat:7 url:3 urlopen 'http geolite maxmind com:3 download:3 geolitecountry read:3 handle:2 gzipfile fileobj=url with open:4 out:2 for:5 line:4 write:2 has:9 option:16 'general:24 'mysql:18 and:10 user:6 password:5 try:8 info:16 connecting:2 host:2 get:14 connect:2 host=config:2 user=config:2 passwd=config:2 db=config:2 cursorclass=mysqldb:2 dictcursor:2 cursor:14 debug:6 connected:2 except:12 error:17 args:12 else:13 query:22 select:2 where:2 address=:2 type= result:12 run:6 fetchall:2 now:5 flags=pygeoip const memory cache len:2 updating blacklist:8 record ip-address:3 'count:2 update:3 count= attempt= code= name=:5 id= 'id commit:2 adding into:3 insert values configuration:8 incomplete:2 running:2 execute:2 return:2 true:4 root:7 path:18 dirname:2 realpath:2 file:32 join:4 'geoip parser:11 usage=:2 usage:2 prog:2 add:14 verbose:12 action=:7 store:7 default=false:7 dest=:7 help=:7 output:11 cfg:14 full:3 attacker service options:9 parse:2 reading:2 'blacklist:2 rawconfigparser:2 'log:4 logfile:6 tmp:2 log':2 format:4 formatter:12 asctime:6 levelname:2 message:6 datefmt=:2 rotatetime:6 timedrotatingfilehandler:2 when=:2 midnight:2 interval=1:2 backupcount=14:2 ioerror:2 print:4 can:4 log:7 exception:2 configure:2 setformatter:4 getlogger:2 'blacklist-db:2 addhandler:4 lvl:6 console:6 streamhandler:2 setlevel:2 are needed but specified keyboardinterrupt:2 ctrl-c:2 systemexit:2 подключение:2 брать конфигурационный:2 файл:5 умолчание:2 пытаться найти тот:3 директория:5 так:2 можно:3 задать:2 путь:8 ключ:3 пример:2 кофигурационный general var localhost pass блэклист:4 ключевой момент выполняться вместе правило:8 iptables:8 посему отредактировать etc:3 action:3 iptables-allports conf:3 исходный:3 вариант:6 actionban:6 fail2ban-:6 blocktype:6 изменить:3 iptables-multiport iptables-new уверенный использоваться это:2 действие внести изменение верность образ соответствующий исполняться:2 наш:4 либо:2 обновлять генерирование впоследствие импортировать получение настройка необходимый искать корнев опять:2 выход создаваться:2 импорт:3 самый указать альтернативный 'ban:2 getint contents:4 firewall:4 address-list:3 'fetching adresses the:2 list:6 blc:3 'type upper 'adding 'ip:2 'add list= comment=blacklist append 'generating rsc:6 script:7 item:2 close 'done generated 'blacklists крон выставить периодичность dev получить:2 поместить web-сервер:2 стоить nginx добавить строка location blacklists:9 вместо мочь ftp tftp тут весь:2 зависеть ваш:2 вкус часть практически полностью украсть статья раз час скачиваться протокол http:2 ниже планировщик:3 скачивание заменить example:2 доменный имя:2 system:4 source=:2 tool fetch url= mode=http downloaded исполнение scheduler:2 comment=:5 interval=1h:2 downloadblacklists on-event=download start-date=jan:2 1970:2 start-time=01_05_00 remove find file-name=blacklists removal old new installblacklists on-event=update start-time=01_15_00 использование запрещать помещаться перед разрешать обрабатываться порядок создать ssh:2 соединение filter action=reject:2 chain=forward:2 reject:2 blacklisted:2 addresses:2 dst-port=5060-5061 in-interface=id-net:2 protocol=udp src-address-list=asterisk dst-port=22 protocol=tcp src-address-list=ssh где id-net мой внешний интерфейс данный претендовать собранный коленка пара-тройка часы надеяться конструктивный критика хабровчанин предложение возможный улучшение архив представить схема